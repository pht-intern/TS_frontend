<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dashboard - Tirumakudalu Properties</title>
    <link rel="icon" type="image/png" href="/images/TirumakudaluProperties_Logo-2048x1858.png">
    <link rel="stylesheet" href="/css/style.css">
    <!-- Google Fonts - Load with fallback, no preconnect to avoid connection issues -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet" onerror="this.onerror=null; this.href='';">
    <!-- Font Awesome - Load with fallback -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" onerror="this.onerror=null; this.remove();">
    <!-- Quill Editor CSS - Load with fallback -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet" onerror="this.onerror=null; this.remove();">
    <style>
        /* Hide body content by default - only show after authentication check passes */
        /* Don't hide html element - it can block dev tools */
        body {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        body.authenticated {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        /* Show loading message while checking authentication */
        body::before {
            content: 'Checking authentication...';
            display: block;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: Inter, sans-serif;
            color: #8B2E3D;
            z-index: 9999;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        body.authenticated::before {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Authentication Check - Must run immediately before any content -->
    <!-- This script runs synchronously and blocks page rendering until authentication is verified -->
    <script>
        // IMMEDIATE SYNCHRONOUS CHECK - No delays, no async operations
        (function() {
            'use strict';
            
            try {
                // Function to clear all authentication data
                function clearAllAuthData() {
                    try {
                        sessionStorage.removeItem('dashboard_authenticated');
                        sessionStorage.removeItem('isAuthenticated');
                        sessionStorage.removeItem('user');
                        localStorage.removeItem('dashboard_authenticated');
                        localStorage.removeItem('isAuthenticated');
                        localStorage.removeItem('user');
                        // CRITICAL FIX: Don't clear session manager tracking data here
                        // This was causing sessions to be cleared prematurely
                        // The session manager handles its own cleanup
                        // Only clear tab_ data if we're actually logging out
                        // (We'll let the session manager handle tab tracking)
                    } catch (e) {
                        // Ignore errors during cleanup
                    }
                }
                
                // CRITICAL FIX: Add retry mechanism for timing issues
                // Sometimes storage isn't immediately available after redirect
                function checkAuthWithRetry(retryCount = 0) {
                    const MAX_RETRIES = 3;
                    const RETRY_DELAY = 50; // 50ms between retries
                    
                    // IMMEDIATE CHECK: Get authentication data synchronously
                    let localAuth, sessionAuth, localUserStr, sessionUserStr;
                    try {
                        localAuth = localStorage.getItem('dashboard_authenticated');
                        sessionAuth = sessionStorage.getItem('dashboard_authenticated');
                        localUserStr = localStorage.getItem('user');
                        sessionUserStr = sessionStorage.getItem('user');
                    } catch (e) {
                        // Storage access failed - treat as not authenticated
                        console.error('Storage access failed:', e);
                        clearAllAuthData();
                        window.location.replace('/index.html');
                        return false;
                    }
                    
                    // Check if authentication flag exists
                    const isAuthenticated = (localAuth === 'true') || (sessionAuth === 'true');
                    
                    // Get user data
                    const userStr = localUserStr || sessionUserStr;
                    
                    // Validate user data exists and is valid JSON with required fields
                    let hasValidUser = false;
                    let user = null;
                    
                    if (userStr) {
                        try {
                            user = JSON.parse(userStr);
                            // STRICT VALIDATION: Must have email (non-empty string) AND admin role
                            if (user && 
                                user.email && 
                                typeof user.email === 'string' && 
                                user.email.trim() !== '' && 
                                user.role === 'admin') {
                                hasValidUser = true;
                            } else {
                                // Invalid user data
                                console.warn('Invalid user data:', user);
                                user = null;
                                hasValidUser = false;
                            }
                        } catch (e) {
                            // Invalid JSON
                            console.error('Error parsing user data:', e, 'Raw:', userStr);
                            user = null;
                            hasValidUser = false;
                        }
                    }
                    
                    // CRITICAL CHECK: Both authentication flag AND valid user data must exist
                    // If either is missing or invalid, retry or redirect
                    if (!isAuthenticated || !hasValidUser || !user) {
                        // If we haven't exhausted retries and this looks like a timing issue, retry
                        if (retryCount < MAX_RETRIES) {
                            // Check if we're coming from a login redirect (has _login param)
                            const urlParams = new URLSearchParams(window.location.search);
                            const isLoginRedirect = urlParams.has('_login');
                            
                            if (isLoginRedirect) {
                                // This is a login redirect - storage might not be ready yet
                                console.log(`Auth check failed (attempt ${retryCount + 1}/${MAX_RETRIES}), retrying...`, {
                                    isAuthenticated,
                                    hasValidUser,
                                    hasUserStr: !!userStr,
                                    localAuth,
                                    sessionAuth
                                });
                                setTimeout(() => {
                                    checkAuthWithRetry(retryCount + 1);
                                }, RETRY_DELAY);
                                return false;
                            }
                        }
                        
                        // No retries left or not a login redirect - redirect to login
                        console.error('Authentication check failed after retries:', {
                            isAuthenticated,
                            hasValidUser,
                            hasUser: !!user,
                            localAuth,
                            sessionAuth,
                            retryCount
                        });
                        clearAllAuthData();
                        // Redirect immediately - use replace to prevent back button
                        try {
                            window.location.replace('/index.html');
                        } catch (e) {
                            try {
                                window.location.href = '/index.html';
                            } catch (e2) {
                                // Last resort - show error and redirect
                                if (document.body) {
                                    document.body.style.display = 'block';
                                    document.body.innerHTML = '<div style="font-family: Inter, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; text-align: center;"><div><h1>Unauthorized Access</h1><p>Redirecting to login...</p></div></div>';
                                    setTimeout(function() {
                                        window.location.href = '/index.html';
                                    }, 1000);
                                }
                            }
                        }
                        return false;
                    }
                    
                    // Authentication passed - return user data
                    return { user, isAuthenticated, hasValidUser };
                }
                
                // Perform auth check with retry
                const authResult = checkAuthWithRetry();
                if (!authResult) {
                    return; // Redirect already handled
                }
                
                const { user, isAuthenticated, hasValidUser } = authResult;
                
                // ADDITIONAL SECURITY: Double-check that we have valid data
                // (Already validated in checkAuthWithRetry, but double-check for safety)
                if (!user || !user.email || typeof user.email !== 'string' || user.email.trim() === '') {
                    console.error('User validation failed:', user);
                    clearAllAuthData();
                    window.location.replace('/index.html');
                    return;
                }
                
                if (user.role !== 'admin') {
                    console.error('User role validation failed:', user.role);
                    clearAllAuthData();
                    window.location.replace('/index.html');
                    return;
                }
                
                // Remove login redirect parameter from URL (clean URL)
                if (window.location.search.includes('_login=')) {
                    const url = new URL(window.location);
                    url.searchParams.delete('_login');
                    window.history.replaceState({}, '', url.pathname + url.search);
                }
                
                // Authentication passed - mark body as authenticated
                // Use multiple methods to ensure the class is added reliably
                function addAuthenticatedClass() {
                    try {
                        if (document.body) {
                            document.body.classList.add('authenticated');
                            // Also add to html element for good measure
                            if (document.documentElement) {
                                document.documentElement.classList.add('authenticated');
                            }
                            return true;
                        }
                    } catch (e) {
                        // Ignore errors
                    }
                    return false;
                }
                
                // Try immediately (body might exist if script runs after body tag)
                addAuthenticatedClass();
                
                // Also set up listeners for when body becomes available
                if (document.readyState === 'loading') {
                    // Document is still loading - wait for DOMContentLoaded
                    document.addEventListener('DOMContentLoaded', function() {
                        addAuthenticatedClass();
                    });
                } else {
                    // Document is already loaded or interactive - try immediately and on next tick
                    addAuthenticatedClass();
                    setTimeout(function() {
                        addAuthenticatedClass();
                    }, 0);
                }
                
                // Fallback: Use readystatechange for older browsers
                if (document.attachEvent) {
                    document.attachEvent('onreadystatechange', function() {
                        if (document.readyState === 'complete' || document.readyState === 'interactive') {
                            addAuthenticatedClass();
                        }
                    });
                }
                
                // Final fallback: Force show after a short delay if authentication passed
                setTimeout(function() {
                    try {
                        if (document.body && !document.body.classList.contains('authenticated')) {
                            // Authentication passed but class wasn't added - add it now
                            addAuthenticatedClass();
                        }
                    } catch (e) {
                        // Ignore errors
                    }
                }, 100);
                
            } catch (error) {
                // If any error occurs, show error message and redirect
                console.error('Authentication check error:', error);
                try {
                    window.location.replace('/index.html');
                } catch (e) {
                    // Show error and redirect
                    try {
                        if (document.body) {
                            document.body.style.display = 'block';
                            document.body.innerHTML = '<div style="font-family: Inter, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; text-align: center;"><div><h1>Error</h1><p>An error occurred. Redirecting to login...</p></div></div>';
                            setTimeout(function() {
                                window.location.href = '/index.html';
                            }, 2000);
                        } else {
                            window.location.href = '/index.html';
                        }
                    } catch (e2) {
                        window.location.href = '/index.html';
                    }
                }
            }
        })();
    </script>
    <!-- Fallback: If JavaScript is disabled, redirect via meta refresh -->
    <noscript>
        <meta http-equiv="refresh" content="0; url=/index.html">
    </noscript>
    
    <!-- Dashboard (shown when authenticated) -->
    <div class="dashboard-container" id="dashboardContainer">
        <!-- Dashboard Header -->
        <header class="dashboard-header">
            <div class="dashboard-header-content">
                <div class="dashboard-header-left">
                    <a href="/" class="dashboard-logo-link">
                        <div class="logo-graphic">
                            <img src="/images/TirumakudaluProperties_Logo-2048x1858.png" alt="Tirumakudalu Properties Logo" class="logo-img">
                        </div>
                    </a>
                    <!-- Dashboard Navigation -->
                    <nav class="dashboard-nav">
                        <ul class="dashboard-nav-menu">
                            <li><a href="/index.html">HOME</a></li>
                            <li><a href="/properties.html">PROPERTIES</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="dashboard-header-right">
                    <!-- User Profile Dropdown -->
                    <div class="dashboard-user-profile" id="dashboardUserProfile">
                        <button class="dashboard-profile-btn" id="dashboardProfileBtn">
                            <div class="dashboard-profile-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span class="dashboard-profile-name" id="dashboardProfileName">Admin</span>
                            <i class="fas fa-chevron-down dashboard-profile-chevron"></i>
                        </button>
                        <div class="dashboard-profile-dropdown" id="dashboardProfileDropdown">
                            <div class="dashboard-profile-header">
                                <div class="dashboard-profile-avatar-large">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="dashboard-profile-info">
                                    <div class="dashboard-profile-fullname" id="dashboardProfileFullname">Seshadri T.S</div>
                                    <div class="dashboard-profile-email" id="dashboardProfileEmail">seshvasu56@gmail.com</div>
                                </div>
                            </div>
                            <a href="/settings.html" class="dashboard-profile-item" target="_blank">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                            <a href="/activity-logs.html" class="dashboard-profile-item" target="_blank">
                                <i class="fas fa-history"></i>
                                <span>Activity Logs</span>
                            </a>
                            <button class="dashboard-profile-item dashboard-profile-logout" id="dashboardLogout">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Main Content -->
        <main class="dashboard-main">
            <div class="dashboard-content">
                <!-- Welcome Message -->
                <div class="dashboard-welcome">
                    <h1 class="dashboard-welcome-title">
                        <i class="fas fa-hand-sparkles"></i>
                        Welcome to Tirumakudalu Dashboard
                    </h1>
                    <p class="dashboard-welcome-subtitle">Manage your properties, inquiries, and content from one central location</p>
                </div>

                <!-- Dashboard Stats -->
                <div class="dashboard-stats">
                    <div class="dashboard-stat-card" data-stat-type="total_properties" data-stat-label="Total Properties">
                        <div class="dashboard-stat-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="dashboard-stat-info">
                            <h3 id="totalProperties">0</h3>
                            <p>Total Properties</p>
                        </div>
                    </div>
                    <div class="dashboard-stat-card" data-stat-type="for_sale" data-stat-label="For Sale">
                        <div class="dashboard-stat-icon sale">
                            <i class="fas fa-tag"></i>
                        </div>
                        <div class="dashboard-stat-info">
                            <h3 id="saleProperties">0</h3>
                            <p>For Sale</p>
                        </div>
                    </div>
                    <div class="dashboard-stat-card" data-stat-type="for_rent" data-stat-label="For Rent">
                        <div class="dashboard-stat-icon rent">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="dashboard-stat-info">
                            <h3 id="rentProperties">0</h3>
                            <p>For Rent</p>
                        </div>
                    </div>
                    <div class="dashboard-stat-card" data-stat-type="total_logs" data-stat-label="Clicks Log">
                        <div class="dashboard-stat-icon">
                            <i class="fas fa-list-alt"></i>
                        </div>
                        <div class="dashboard-stat-info">
                            <h3 id="totalLogs">0</h3>
                            <p>Clicks Log</p>
                        </div>
                    </div>
                </div>

                <!-- Properties Table -->
                <div class="dashboard-properties-section">
                    <div class="section-header">
                        <h2>Properties</h2>
                    </div>
                    <div class="dashboard-properties-actions" style="display: flex; gap: 1rem; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <div class="dashboard-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="propertySearch" placeholder="Search properties...">
                        </div>
                        <input type="file" id="importPropertiesFile" accept=".csv" style="display: none;">
                        <button class="dashboard-export dashboard-import" id="importPropertiesBtn" title="Import Properties from CSV" style="white-space: nowrap;">
                            <i class="fas fa-upload"></i>
                            IMPORT CSV
                        </button>
                        <button class="dashboard-export" id="exportPropertiesBtn" title="Export Properties to CSV" style="white-space: nowrap;">
                            <i class="fas fa-download"></i>
                            EXPORT CSV
                        </button>
                        <button class="dashboard-btn-primary" id="addPropertyBtn" style="white-space: nowrap;">
                            <i class="fas fa-plus"></i>
                            Add Property
                        </button>
                    </div>
                    <div class="dashboard-properties-table-container properties-table-scrollable">
                        <table class="dashboard-properties-table">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Title</th>
                                    <th>Location</th>
                                    <th>Type</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="propertiesTableBody">
                                <!-- Properties will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Testimonials Section -->
                <div class="dashboard-properties-section">
                    <div class="section-header">
                        <h2>Testimonials</h2>
                    </div>
                    <div class="dashboard-properties-actions" style="display: flex; gap: 1rem; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <div class="dashboard-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="testimonialSearch" placeholder="Search testimonials...">
                        </div>
                        <input type="file" id="importTestimonialsFile" accept=".csv" style="display: none;">
                        <button class="dashboard-export dashboard-import" id="importTestimonialsBtn" title="Import Testimonials from CSV" style="white-space: nowrap;">
                            <i class="fas fa-upload"></i>
                            IMPORT CSV
                        </button>
                        <button class="dashboard-export" id="exportTestimonialsBtn" title="Export Testimonials to CSV" style="white-space: nowrap;">
                            <i class="fas fa-download"></i>
                            EXPORT CSV
                        </button>
                        <button class="dashboard-btn-primary" id="addTestimonialBtn" style="white-space: nowrap;">
                            <i class="fas fa-plus"></i>
                            Add Testimonial
                        </button>
                    </div>
                    <div class="dashboard-properties-table-container properties-table-scrollable">
                        <table class="dashboard-properties-table">
                            <thead>
                                <tr>
                                    <th>Client Name</th>
                                    <th>Email</th>
                                    <th>Service Type</th>
                                    <th>Rating</th>
                                    <th>Message</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="testimonialsTableBody">
                                <!-- Testimonials will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Partners Section -->
                <div class="dashboard-properties-section">
                    <div class="section-header">
                        <h2>Partners</h2>
                    </div>
                    <div class="dashboard-properties-actions" style="display: flex; gap: 1rem; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <div class="dashboard-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="partnerSearch" placeholder="Search partners...">
                        </div>
                        <input type="file" id="importPartnersFile" accept=".csv" style="display: none;">
                        <button class="dashboard-export dashboard-import" id="importPartnersBtn" title="Import Partners from CSV" style="white-space: nowrap;">
                            <i class="fas fa-upload"></i>
                            IMPORT CSV
                        </button>
                        <button class="dashboard-export" id="exportPartnersBtn" title="Export Partners to CSV" style="white-space: nowrap;">
                            <i class="fas fa-download"></i>
                            EXPORT CSV
                        </button>
                        <button class="dashboard-btn-primary" id="addPartnerBtn" style="white-space: nowrap;">
                            <i class="fas fa-plus"></i>
                            Add Partner
                        </button>
                    </div>
                    <div class="dashboard-properties-table-container">
                        <table class="dashboard-properties-table">
                            <thead>
                                <tr>
                                    <th>Logo</th>
                                    <th>Name</th>
                                    <th>Website</th>
                                    <th>Display Order</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="partnersTableBody">
                                <!-- Partners will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Blogs Section -->
                <div class="dashboard-properties-section">
                    <div class="section-header">
                        <h2>Blogs</h2>
                    </div>
                    <div class="dashboard-properties-actions" style="display: flex; gap: 1rem; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <div class="dashboard-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="blogSearch" placeholder="Search blogs...">
                        </div>
                        <input type="file" id="importBlogsFile" accept=".csv" style="display: none;">
                        <button class="dashboard-export dashboard-import" id="importBlogsBtn" title="Import Blogs from CSV" style="white-space: nowrap;">
                            <i class="fas fa-upload"></i>
                            IMPORT CSV
                        </button>
                        <button class="dashboard-export" id="exportBlogsBtn" title="Export Blogs to CSV" style="white-space: nowrap;">
                            <i class="fas fa-download"></i>
                            EXPORT CSV
                        </button>
                        <button class="dashboard-btn-primary" id="addBlogBtn" style="white-space: nowrap;">
                            <i class="fas fa-plus"></i>
                            Add Blog
                        </button>
                    </div>
                    <div class="dashboard-properties-table-container properties-table-scrollable">
                        <table class="dashboard-properties-table">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Author</th>
                                    <th>Views</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="blogsTableBody">
                                <!-- Blogs will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Schedule Visit Requests Section -->
                <div class="dashboard-properties-section">
                    <div class="section-header">
                        <h2>Schedule Visit Requests</h2>
                    </div>
                    <div class="dashboard-properties-actions" style="display: flex; gap: 1rem; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <div class="dashboard-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="scheduleVisitSearch" placeholder="Search visit requests...">
                        </div>
                        <input type="file" id="importScheduleVisitsFile" accept=".csv" style="display: none;">
                        <button class="dashboard-export dashboard-import" id="importScheduleVisitsBtn" title="Import Schedule Visit Requests from CSV" style="white-space: nowrap;">
                            <i class="fas fa-upload"></i>
                            IMPORT CSV
                        </button>
                        <button class="dashboard-export" id="exportScheduleVisitsBtn" title="Export Schedule Visit Requests to CSV" style="white-space: nowrap;">
                            <i class="fas fa-download"></i>
                            EXPORT CSV
                        </button>
                    </div>
                    <div class="dashboard-properties-table-container schedule-visit-table-container">
                        <table class="dashboard-properties-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Property</th>
                                    <th>Visit Details</th>
                                    <th>IP Address</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleVisitTableBody">
                                <!-- Schedule Visit requests will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Contact Inquiries Section -->
                <div class="dashboard-properties-section">
                    <div class="section-header">
                        <h2>Contact Inquiries</h2>
                    </div>
                    <div class="dashboard-properties-actions" style="display: flex; gap: 1rem; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <div class="dashboard-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="contactInquirySearch" placeholder="Search contact inquiries...">
                        </div>
                        <input type="file" id="importContactInquiriesFile" accept=".csv" style="display: none;">
                        <button class="dashboard-export dashboard-import" id="importContactInquiriesBtn" title="Import Contact Inquiries from CSV" style="white-space: nowrap;">
                            <i class="fas fa-upload"></i>
                            IMPORT CSV
                        </button>
                        <button class="dashboard-export" id="exportContactInquiriesBtn" title="Export Contact Inquiries to CSV" style="white-space: nowrap;">
                            <i class="fas fa-download"></i>
                            EXPORT CSV
                        </button>
                    </div>
                    <div class="dashboard-properties-table-container contact-inquiry-table-container">
                        <table class="dashboard-properties-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Subject</th>
                                    <th>Message</th>
                                    <th>Property</th>
                                    <th>IP Address</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="contactInquiryTableBody">
                                <!-- Contact inquiries will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Visitor Info Section -->
                <div class="dashboard-properties-section">
                    <div class="section-header">
                        <h2>Website Visitors</h2>
                    </div>
                    <div class="dashboard-properties-actions" style="display: flex; gap: 1rem; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <div class="dashboard-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="visitorSearch" placeholder="Search visitors...">
                        </div>
                        <input type="file" id="importVisitorsFile" accept=".csv" style="display: none;">
                        <button class="dashboard-export dashboard-import" id="importVisitorsBtn" title="Import Website Visitors from CSV" style="white-space: nowrap;">
                            <i class="fas fa-upload"></i>
                            IMPORT CSV
                        </button>
                        <button class="dashboard-export" id="exportVisitorsBtn" title="Export Website Visitors to CSV" style="white-space: nowrap;">
                            <i class="fas fa-download"></i>
                            EXPORT CSV
                        </button>
                    </div>
                    <div class="dashboard-properties-table-container">
                        <table class="dashboard-properties-table">
                            <thead>
                                <tr>
                                    <th>Full Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Looking For</th>
                                    <th>IP Address</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="visitorInfoTableBody">
                                <!-- Visitor info will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Page Visit Counts Section -->
                <div class="dashboard-properties-section">
                    <div class="section-header">
                        <h2>Page Visit Counts</h2>
                    </div>
                    <div class="dashboard-properties-table-container">
                        <table class="dashboard-properties-table">
                            <thead>
                                <tr>
                                    <th>Page Name</th>
                                    <th>Total Visits</th>
                                    <th>Unique Visitors</th>
                                    <th>Authenticated Visitors</th>
                                </tr>
                            </thead>
                            <tbody id="pageVisitsTableBody">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 2rem;">
                                        <i class="fas fa-spinner fa-spin"></i> Loading page visit statistics...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Partner Modal -->
    <div class="dashboard-modal" id="partnerModal">
        <div class="dashboard-modal-overlay" id="partnerModalOverlay"></div>
        <div class="dashboard-modal-content">
            <div class="dashboard-modal-header">
                <h2 id="partnerModalTitle">Add New Partner</h2>
                <button class="dashboard-modal-close" id="partnerModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="dashboard-property-form" id="partnerForm">
                <input type="hidden" id="partnerId" name="id">
                
                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label for="partnerName">
                            <i class="fas fa-building"></i>
                            Partner Name *
                        </label>
                        <input type="text" id="partnerName" name="name" placeholder="e.g., L&T Realty" required>
                    </div>
                    <div class="dashboard-form-group">
                        <label for="partnerWebsite">
                            <i class="fas fa-globe"></i>
                            Website URL
                        </label>
                        <input type="url" id="partnerWebsite" name="website_url" placeholder="e.g., https://example.com">
                    </div>
                </div>

                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label for="partnerDisplayOrder">
                            <i class="fas fa-sort-numeric-down"></i>
                            Display Order
                        </label>
                        <input type="number" id="partnerDisplayOrder" name="display_order" placeholder="e.g., 1" min="0" value="0">
                    </div>
                    <div class="dashboard-form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-top: 2rem;">
                            <input type="checkbox" id="partnerIsActive" name="is_active" style="width: auto;" checked>
                            <span>Active</span>
                        </label>
                    </div>
                </div>

                <div class="dashboard-form-group">
                    <label>
                        <i class="fas fa-image"></i>
                        Partner Logo (PNG or SVG only, Max 2 files) *
                    </label>
                    <div class="dashboard-image-upload-area" id="partnerLogoUploadArea">
                        <input type="file" id="partnerLogos" name="logos" multiple accept="image/png,image/svg+xml,.png,.svg" style="display: none;">
                        <div class="dashboard-image-upload-placeholder" id="partnerLogoUploadPlaceholder">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload logo(s) or drag and drop</p>
                            <span>Supports: PNG, SVG only (Max 2 files, 5MB per file)</span>
                        </div>
                        <div class="dashboard-image-preview-container" id="partnerLogoPreviewContainer"></div>
                    </div>
                </div>

                <div class="dashboard-modal-actions">
                    <button type="button" class="dashboard-btn-secondary" id="cancelPartnerBtn">Cancel</button>
                    <button type="submit" class="dashboard-btn-primary">
                        <i class="fas fa-save"></i>
                        Save Partner
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Testimonial Modal -->
    <div class="dashboard-modal" id="testimonialModal">
        <div class="dashboard-modal-overlay" id="testimonialModalOverlay"></div>
        <div class="dashboard-modal-content">
            <div class="dashboard-modal-header">
                <h2 id="testimonialModalTitle">Add New Testimonial</h2>
                <button class="dashboard-modal-close" id="testimonialModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="dashboard-property-form" id="testimonialForm">
                <input type="hidden" id="testimonialId" name="id">
                
                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label for="testimonialClientName">
                            <i class="fas fa-user"></i>
                            Client Name *
                        </label>
                        <input type="text" id="testimonialClientName" name="client_name" placeholder="e.g., John Doe" required>
                    </div>
                    <div class="dashboard-form-group">
                        <label for="testimonialClientEmail">
                            <i class="fas fa-envelope"></i>
                            Email
                        </label>
                        <input type="email" id="testimonialClientEmail" name="client_email" placeholder="e.g., john@example.com">
                    </div>
                </div>

                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label for="testimonialClientPhone">
                            <i class="fas fa-phone"></i>
                            Phone
                        </label>
                        <input type="text" id="testimonialClientPhone" name="client_phone" placeholder="e.g., +1234567890">
                    </div>
                    <div class="dashboard-form-group">
                        <label for="testimonialServiceType">
                            <i class="fas fa-briefcase"></i>
                            Service Type
                        </label>
                        <input type="text" id="testimonialServiceType" name="service_type" placeholder="e.g., Property Purchase">
                    </div>
                </div>

                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label for="testimonialRating">
                            <i class="fas fa-star"></i>
                            Rating (1-5)
                        </label>
                        <select id="testimonialRating" name="rating">
                            <option value="">Select Rating</option>
                            <option value="1">1 Star</option>
                            <option value="2">2 Stars</option>
                            <option value="3">3 Stars</option>
                            <option value="4">4 Stars</option>
                            <option value="5">5 Stars</option>
                        </select>
                    </div>
                </div>

                <div class="dashboard-form-group">
                    <label for="testimonialMessage">
                        <i class="fas fa-comment"></i>
                        Message *
                    </label>
                    <textarea id="testimonialMessage" name="message" rows="5" placeholder="Enter testimonial message..." required></textarea>
                </div>

                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="testimonialIsApproved" name="is_approved" style="width: auto;">
                            <span>Approved</span>
                        </label>
                    </div>
                </div>

                <div class="dashboard-modal-actions">
                    <button type="button" class="dashboard-btn-secondary" id="cancelTestimonialBtn">Cancel</button>
                    <button type="submit" class="dashboard-btn-primary">
                        <i class="fas fa-save"></i>
                        Save Testimonial
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- Add/Edit Blog Modal -->
    <div class="dashboard-modal" id="blogModal">
        <div class="dashboard-modal-overlay" id="blogModalOverlay"></div>
        <div class="dashboard-modal-content">
            <div class="dashboard-modal-header">
                <h2 id="blogModalTitle">Add New Blog</h2>
                <button class="dashboard-modal-close" id="blogModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="dashboard-property-form" id="blogForm">
                <input type="hidden" id="blogId" name="id">
                
                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label for="blogTitle">
                            <i class="fas fa-heading"></i>
                            Blog Title *
                        </label>
                        <input type="text" id="blogTitle" name="title" placeholder="e.g., Top 10 Real Estate Investment Tips" required>
                    </div>
                    <div class="dashboard-form-group">
                        <label for="blogCategory">
                            <i class="fas fa-tags"></i>
                            Category
                        </label>
                        <select id="blogCategory" name="category">
                            <option value="">Select Category</option>
                            <option value="real-estate">Real Estate</option>
                            <option value="investment">Investment</option>
                            <option value="property-management">Property Management</option>
                            <option value="market-trends">Market Trends</option>
                            <option value="tips">Tips & Advice</option>
                            <option value="news">News & Updates</option>
                        </select>
                    </div>
                </div>

                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label for="blogAuthor">
                            <i class="fas fa-user"></i>
                            Author
                        </label>
                        <input type="text" id="blogAuthor" name="author" placeholder="e.g., Tirumakudalu Properties" value="Tirumakudalu Properties">
                    </div>
                </div>

                <div class="dashboard-form-group">
                    <label>
                        <i class="fas fa-image"></i>
                        Blog Image *
                    </label>
                    <div class="dashboard-image-upload-area" id="blogImageUploadArea">
                        <input type="file" id="blogImage" name="image" accept="image/*" style="display: none;">
                        <div class="dashboard-image-upload-placeholder" id="blogImageUploadPlaceholder">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload image or drag and drop</p>
                            <span>Supports: JPG, PNG, GIF, WebP (Max 5MB)</span>
                        </div>
                        <div class="dashboard-image-preview-container" id="blogImagePreviewContainer"></div>
                    </div>
                </div>

                <div class="dashboard-form-group">
                    <label for="blogExcerpt">
                        <i class="fas fa-align-left"></i>
                        Excerpt *
                    </label>
                    <textarea id="blogExcerpt" name="excerpt" rows="3" placeholder="Enter a brief summary of the blog post..." required></textarea>
                </div>

                <div class="dashboard-form-group">
                    <label for="blogContent">
                        <i class="fas fa-file-alt"></i>
                        Content *
                    </label>
                    <div id="blogContentEditor" style="min-height: 300px;"></div>
                    <textarea id="blogContent" name="content" style="display: none;"></textarea>
                </div>

                <div class="dashboard-form-group">
                    <label>
                        <i class="fas fa-tags"></i>
                        Tags
                    </label>
                    <div class="dashboard-features-container">
                        <div class="dashboard-features-input-wrapper">
                            <input type="text" id="blogTagInput" placeholder="Add a tag (e.g., bengaluru, investment, etc.)">
                            <button type="button" class="dashboard-btn-add-feature" id="addBlogTagBtn">
                                <i class="fas fa-plus"></i>
                                Add
                            </button>
                        </div>
                        <div class="dashboard-features-list" id="blogTagsList"></div>
                    </div>
                </div>

                <div class="dashboard-form-row">
                    <div class="dashboard-form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="blogIsFeatured" name="is_featured" style="width: auto;">
                            <span>Featured</span>
                        </label>
                    </div>
                    <div class="dashboard-form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="blogIsActive" name="is_active" style="width: auto;" checked>
                            <span>Active</span>
                        </label>
                    </div>
                </div>

                <div class="dashboard-modal-actions">
                    <button type="button" class="dashboard-btn-secondary" id="cancelBlogBtn">Cancel</button>
                    <button type="submit" class="dashboard-btn-primary">
                        <i class="fas fa-save"></i>
                        Save Blog
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Residential Property Modal -->
    <div class="dashboard-modal" id="residentialPropertyModal">
        <div class="dashboard-modal-overlay" id="residentialPropertyModalOverlay"></div>
        <div class="dashboard-modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="dashboard-modal-header">
                <h2 id="residentialModalTitle">Add Other Properties</h2>
                <button class="dashboard-modal-close" id="residentialPropertyModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="dashboard-property-form" id="residentialPropertyForm">
                <input type="hidden" id="residentialPropertyId" name="id">
                
                <!-- Step Progress Indicator -->
                <div class="dashboard-form-steps">
                    <div class="dashboard-step-indicator">
                        <div class="dashboard-step-item active" data-step="1">
                            <div class="dashboard-step-number">1</div>
                            <div class="dashboard-step-label">Basic Info</div>
                        </div>
                        <div class="dashboard-step-line"></div>
                        <div class="dashboard-step-item" data-step="2">
                            <div class="dashboard-step-number">2</div>
                            <div class="dashboard-step-label">Property Details</div>
                        </div>
                        <div class="dashboard-step-line"></div>
                        <div class="dashboard-step-item" data-step="3">
                            <div class="dashboard-step-number">3</div>
                            <div class="dashboard-step-label">Media & Features</div>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Basic Information -->
                <div class="dashboard-form-step active" data-step="1">
                    <div class="dashboard-form-row">
                        <div class="dashboard-form-group">
                            <label for="residentialPropertyName">
                                <i class="fas fa-building"></i>
                                Project Name *
                            </label>
                            <input type="text" id="residentialPropertyName" name="property_name" placeholder="e.g., Prestige Shantiniketan" required>
                        </div>
                        <div class="dashboard-form-group">
                            <label for="residentialCity">
                                <i class="fas fa-map-marker-alt"></i>
                                City *
                            </label>
                            <select id="residentialCity" name="city" required>
                                <option value="">Select City</option>
                            </select>
                        </div>
                    </div>

                    <div class="dashboard-form-row">
                        <div class="dashboard-form-group">
                            <label for="residentialLocality">
                                <i class="fas fa-location-dot"></i>
                                Locality/Area *
                            </label>
                            <input type="text" id="residentialLocality" name="locality" placeholder="e.g., Whitefield" required>
                        </div>
                        <div class="dashboard-form-group">
                            <label for="residentialLocationLink">
                                <i class="fas fa-link"></i>
                                Location Link
                            </label>
                            <input type="url" id="residentialLocationLink" name="location_link" placeholder="e.g., https://maps.google.com/...">
                        </div>
                    </div>

                    <div class="dashboard-form-row">
                        <div class="dashboard-form-group">
                            <label for="residentialPropertyType">
                                <i class="fas fa-home"></i>
                                Property Type *
                            </label>
                            <select id="residentialPropertyType" name="property_type" required>
                                <option value="">Select Property Type</option>
                                <option value="apartments">Apartments</option>
                                <option value="villas">Villas</option>
                                <option value="plot_properties">Plot Properties</option>
                                <option value="individual_house">Individual House</option>
                            </select>
                        </div>
                        <div class="dashboard-form-group">
                            <label for="residentialPrice">
                                <i class="fas fa-rupee-sign"></i>
                                Price *
                            </label>
                            <input type="text" id="residentialPrice" name="price" placeholder="e.g., Rs. 1.2 Cr" required>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Property Details (Dynamic based on property type) -->
                <div class="dashboard-form-step" data-step="2" id="residentialStep2">
                    <!-- Content will be dynamically loaded based on property type -->
                </div>

                <!-- Step 3: Media & Features -->
                <div class="dashboard-form-step" data-step="3">
                    <div class="dashboard-form-group">
                        <label>
                            <i class="fas fa-images"></i>
                            Gallery Details
                        </label>
                        <div id="residentialGalleryContainer">
                            <!-- Gallery items will be dynamically added here -->
                        </div>
                        <button type="button" class="dashboard-btn-secondary" id="residentialAddImageBtn" style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i>
                            Add Image
                        </button>
                    </div>

                    <div class="dashboard-form-group">
                        <label for="residentialVideoPreviewLink">
                            <i class="fas fa-video"></i>
                            Video Preview Link
                        </label>
                        <input type="url" id="residentialVideoPreviewLink" name="video_preview_link" placeholder="e.g., https://www.youtube.com/watch?v=... or https://vimeo.com/...">
                    </div>

                    <div class="dashboard-form-group">
                        <label for="residentialDescription">
                            <i class="fas fa-align-left"></i>
                            Description
                        </label>
                        <textarea id="residentialDescription" name="description" rows="5" placeholder="Enter property description..."></textarea>
                    </div>

                    <div class="dashboard-form-row">
                        <div class="dashboard-form-group">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="residentialIsFeatured" name="is_featured" style="width: auto;">
                                <span>Featured</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Hidden fields for form submission -->
                <input type="hidden" id="residentialType" name="type" value="residential">
                <input type="hidden" id="residentialUnitType" name="unit_type" value="bhk">
                <input type="hidden" id="residentialBedrooms" name="bedrooms" value="1">

                <!-- Step Navigation Buttons -->
                <div class="dashboard-modal-actions">
                    <button type="button" class="dashboard-btn-secondary" id="cancelResidentialPropertyBtn">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                    <div class="dashboard-step-buttons">
                        <button type="button" class="dashboard-btn-secondary" id="residentialPrevStepBtn" style="display: none;">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button type="button" class="dashboard-btn-primary" id="residentialNextStepBtn">
                            Next
                            <i class="fas fa-arrow-right"></i>
                        </button>
                        <button type="submit" class="dashboard-btn-primary" id="residentialSubmitBtn" style="display: none;">
                            <i class="fas fa-save"></i>
                            Save Property
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="dashboard-modal" id="deleteModal">
        <div class="dashboard-modal-overlay" id="deleteModalOverlay"></div>
        <div class="dashboard-modal-content dashboard-modal-small">
            <div class="dashboard-modal-header">
                <h2 id="deleteModalTitle">Delete Property</h2>
                <button class="dashboard-modal-close" id="deleteModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="dashboard-modal-body">
                <p id="deleteModalMessage">Are you sure you want to delete this property? This action cannot be undone.</p>
            </div>
            <div class="dashboard-modal-actions">
                <button type="button" class="dashboard-btn-secondary" id="cancelDeleteBtn">Cancel</button>
                <button type="button" class="dashboard-btn-danger" id="confirmDeleteBtn">
                    <i class="fas fa-trash"></i>
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Contact Inquiry View Modal -->
    <div class="dashboard-modal" id="contactInquiryViewModal">
        <div class="dashboard-modal-overlay" id="contactInquiryViewModalOverlay"></div>
        <div class="dashboard-modal-content" style="max-width: 800px;">
            <div class="dashboard-modal-header">
                <h2>
                    <i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>
                    Contact Inquiry Details
                </h2>
                <button class="dashboard-modal-close" id="contactInquiryViewModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="dashboard-modal-body" style="padding: 2rem;">
                <div class="contact-inquiry-view-content">
                    <!-- Status Badge -->
                    <div class="contact-inquiry-status-section" style="margin-bottom: 2rem;">
                        <label class="contact-inquiry-label">Status</label>
                        <div id="contactInquiryViewStatus" class="status-badge"></div>
                    </div>

                    <!-- Inquiry Information Grid -->
                    <div class="contact-inquiry-info-grid">
                        <div class="contact-inquiry-info-item">
                            <div class="contact-inquiry-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="contact-inquiry-info-content">
                                <label class="contact-inquiry-label">Name</label>
                                <p class="contact-inquiry-value" id="contactInquiryViewName">-</p>
                            </div>
                        </div>

                        <div class="contact-inquiry-info-item">
                            <div class="contact-inquiry-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="contact-inquiry-info-content">
                                <label class="contact-inquiry-label">Email</label>
                                <p class="contact-inquiry-value">
                                    <a href="#" id="contactInquiryViewEmail" style="color: var(--primary-color); text-decoration: none;">-</a>
                                </p>
                            </div>
                        </div>

                        <div class="contact-inquiry-info-item">
                            <div class="contact-inquiry-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="contact-inquiry-info-content">
                                <label class="contact-inquiry-label">Phone</label>
                                <p class="contact-inquiry-value" id="contactInquiryViewPhone">-</p>
                            </div>
                        </div>

                        <div class="contact-inquiry-info-item">
                            <div class="contact-inquiry-icon">
                                <i class="fas fa-tag"></i>
                            </div>
                            <div class="contact-inquiry-info-content">
                                <label class="contact-inquiry-label">Subject</label>
                                <p class="contact-inquiry-value" id="contactInquiryViewSubject">-</p>
                            </div>
                        </div>

                        <div class="contact-inquiry-info-item">
                            <div class="contact-inquiry-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="contact-inquiry-info-content">
                                <label class="contact-inquiry-label">Property</label>
                                <p class="contact-inquiry-value" id="contactInquiryViewProperty">-</p>
                            </div>
                        </div>

                        <div class="contact-inquiry-info-item">
                            <div class="contact-inquiry-icon">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="contact-inquiry-info-content">
                                <label class="contact-inquiry-label">IP Address</label>
                                <p class="contact-inquiry-value" id="contactInquiryViewIpAddress">-</p>
                            </div>
                        </div>

                        <div class="contact-inquiry-info-item">
                            <div class="contact-inquiry-icon">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <div class="contact-inquiry-info-content">
                                <label class="contact-inquiry-label">Date Submitted</label>
                                <p class="contact-inquiry-value" id="contactInquiryViewDate">-</p>
                            </div>
                        </div>

                        <div class="contact-inquiry-info-item">
                            <div class="contact-inquiry-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="contact-inquiry-info-content">
                                <label class="contact-inquiry-label">Last Updated</label>
                                <p class="contact-inquiry-value" id="contactInquiryViewUpdated">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- Message Section -->
                    <div class="contact-inquiry-message-section" style="margin-top: 2rem;">
                        <label class="contact-inquiry-label">
                            <i class="fas fa-comment-alt" style="margin-right: 0.5rem;"></i>
                            Message
                        </label>
                        <div class="contact-inquiry-message-box" id="contactInquiryViewMessage">
                            -
                        </div>
                    </div>

                    <!-- Status Update Section -->
                    <div class="contact-inquiry-status-update" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--primary-lighter);">
                        <label class="contact-inquiry-label">
                            <i class="fas fa-edit" style="margin-right: 0.5rem;"></i>
                            Update Status
                        </label>
                        <select class="dashboard-status-select" id="contactInquiryViewStatusSelect" style="width: 100%; max-width: 300px; margin-top: 0.5rem;">
                            <option value="new">New</option>
                            <option value="read">Read</option>
                            <option value="replied">Replied</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="dashboard-modal-actions" style="padding: 1.5rem 2rem; border-top: 2px solid var(--primary-lighter);">
                <button type="button" class="dashboard-btn-secondary" id="contactInquiryViewCloseBtn">Close</button>
                <button type="button" class="dashboard-btn-primary" id="contactInquiryViewUpdateBtn">
                    <i class="fas fa-save"></i>
                    Update Status
                </button>
            </div>
        </div>
    </div>

    <script>
        // CRITICAL: Suppress browser extension errors IMMEDIATELY - must run before any other scripts
        // This prevents browser extension errors from cluttering the console
        (function() {
            'use strict';
            
            // Suppress console errors from browser extensions
            const originalConsoleError = console.error;
            console.error = function(...args) {
                const message = args.join(' ');
                if (message && (
                    message.includes('message channel closed') ||
                    message.includes('Extension context invalidated') ||
                    message.includes('Receiving end does not exist') ||
                    message.includes('asynchronous response') ||
                    message.includes('message channel closed before a response') ||
                    message.includes('listener indicated an asynchronous response')
                )) {
                    // Suppress this error - it's from a browser extension
                    return;
                }
                // Call original console.error for legitimate errors
                originalConsoleError.apply(console, args);
            };
            
            // Suppress window error events from browser extensions
            window.addEventListener('error', function(event) {
                const message = event.message || (event.error && event.error.message) || '';
                if (message && (
                    message.includes('message channel closed') ||
                    message.includes('Extension context invalidated') ||
                    message.includes('Receiving end does not exist') ||
                    message.includes('asynchronous response') ||
                    message.includes('message channel closed before a response') ||
                    message.includes('listener indicated an asynchronous response')
                )) {
                    event.preventDefault();
                    event.stopPropagation();
                    event.stopImmediatePropagation();
                    return false;
                }
            }, true);
            
            // Suppress unhandled promise rejections from browser extensions
            window.addEventListener('unhandledrejection', function(event) {
                let message = '';
                
                if (event.reason) {
                    if (typeof event.reason === 'object' && event.reason.message) {
                        message = event.reason.message;
                    } else if (typeof event.reason === 'string') {
                        message = event.reason;
                    } else if (event.reason.toString) {
                        message = event.reason.toString();
                    }
                }
                
                if (message && (
                    message.includes('message channel closed') ||
                    message.includes('Extension context invalidated') ||
                    message.includes('Receiving end does not exist') ||
                    message.includes('asynchronous response') ||
                    message.includes('message channel closed before a response') ||
                    message.includes('listener indicated an asynchronous response')
                )) {
                    event.preventDefault();
                    event.stopPropagation();
                    return false;
                }
            }, true);
        })();
    </script>
    <!-- Quill Editor - Load with fallback -->
    <script src="https://cdn.quilljs.com/1.3.7/quill.js" onerror="console.warn('Quill.js CDN failed to load'); this.onerror=null; this.remove();"></script>
    <!-- Chart.js - Load with fallback -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" onerror="console.warn('Chart.js CDN failed to load'); this.onerror=null; this.remove();"></script>
    <script src="/js/session-manager.js"></script>
    <script src="/js/dashboard.js?v=20250120120000"></script>
    <script src="/js/page-tracking.js"></script>
</body>
</html>

