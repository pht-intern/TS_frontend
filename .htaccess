# .htaccess for TSProperties
# Forward API routes to Passenger WSGI application

# Enable rewrite engine
RewriteEngine On

# Forward /api/* routes to Passenger WSGI
# This ensures Apache forwards API requests to Flask instead of looking for a physical /api folder
RewriteRule ^api(/.*)?$ /passenger_wsgi.py [L]

# Prevent directory browsing
Options -Indexes

# Protect sensitive files
<FilesMatch "^(\.env|\.git|requirements\.txt)$">
    Require all denied
</FilesMatch>

# Character encoding
AddDefaultCharset UTF-8

# ============================================
# BROWSER CACHING - HTTP Cache Headers
# ============================================
# Note: Requires mod_headers to be enabled (usually enabled by default in cPanel)
# If headers don't work, contact your hosting provider to enable mod_headers

# Enable caching for images (1 year)
<FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|avif|ico)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "Thu, 31 Dec 2025 23:59:59 GMT"
</FilesMatch>

# Enable caching for CSS files (1 year)
<FilesMatch "\.(css)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "Thu, 31 Dec 2025 23:59:59 GMT"
</FilesMatch>

# Enable caching for JavaScript files (1 year)
<FilesMatch "\.(js)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "Thu, 31 Dec 2025 23:59:59 GMT"
</FilesMatch>

# Enable caching for fonts (1 year)
<FilesMatch "\.(woff|woff2|ttf|eot|otf)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "Thu, 31 Dec 2025 23:59:59 GMT"
    # CORS headers for fonts (if needed)
    Header set Access-Control-Allow-Origin "*"
</FilesMatch>

# HTML files - short cache (1 hour) to allow updates
<FilesMatch "\.(html|htm)$">
    Header set Cache-Control "public, max-age=3600, must-revalidate"
    Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
</FilesMatch>

# JSON and XML - short cache (1 hour)
<FilesMatch "\.(json|xml)$">
    Header set Cache-Control "public, max-age=3600"
</FilesMatch>

# Disable caching for API responses (handled by Flask, but ensure no caching)
<LocationMatch "^/api/">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</LocationMatch>
