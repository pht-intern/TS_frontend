<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Properties - Tirumakudalu Properties</title>
    <link rel="icon" type="image/webp" href="/images/TS_logo.webp">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        html {
            visibility: hidden;
            overflow-x: hidden;
            width: 100%;
            max-width: 100%
        }

        html.loaded {
            visibility: visible;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 18px;
            line-height: 1.6;
            color: #1a1a1a;
            overflow-x: hidden;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box
        }

        .navbar {
            min-height: 80px;
        }

        .properties-hero {
            min-height: 300px;
        }
    </style>
    <!-- Google Fonts - Load with fallback, no preconnect to avoid connection issues -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700&display=swap"
        rel="stylesheet" onerror="this.onerror=null; this.href='';">
    <!-- Font Awesome - Load with fallback -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        onerror="this.onerror=null; this.remove();">
</head>

<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-content">
                <div class="top-bar-left">
                    <a href="tel:+919741111756"><i class="fas fa-phone"></i> +91 97411 11756</a>
                    <a href="mailto:info@tirumakudaluproperties.com"><i class="fas fa-envelope"></i>
                        info@tirumakudaluproperties.com</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <a href="/index.html" class="logo-link">
                        <div class="logo-graphic">
                            <img src="/images/TS_logo.webp" alt="Tirumakudalu Properties Logo" class="logo-img"
                                loading="lazy">
                        </div>
                    </a>
                </div>
                <ul class="nav-menu" id="navMenu">
                    <li><a href="/index.html">HOME</a></li>
                    <li><a href="/properties.html" class="active">PROPERTIES</a></li>
                    <li><a href="#contact">CONTACT</a></li>
                </ul>
                <div class="nav-search">
                    <div class="nav-search-wrapper">
                        <i class="fas fa-search nav-search-icon"></i>
                        <input type="text" id="navSearchInput" class="nav-search-input"
                            placeholder="Search properties..." autocomplete="off">
                        <button type="button" class="nav-search-clear" id="navSearchClear" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="nav-actions">
                    <button class="btn-login" id="loginBtn">
                        <i class="fas fa-user"></i>
                        <span>LOGIN</span>
                    </button>
                </div>
                <div class="nav-toggle" id="navToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Properties Hero Section -->
    <section class="properties-hero">
        <div class="container">
            <div class="properties-hero-content">
                <h1 class="properties-hero-title">Find Your Perfect Property</h1>
                <p class="properties-hero-subtitle">Discover premium real estate opportunities across Bengaluru</p>
            </div>
        </div>
    </section>

    <!-- Properties Section -->
    <section class="properties-section">
        <div class="container">
            <div class="properties-layout">
                <!-- Sidebar Filters -->
                <aside class="properties-sidebar">
                    <div class="sidebar-header">
                        <h3><i class="fas fa-filter"></i> Filters</h3>
                        <button type="button" class="sidebar-toggle" id="sidebarToggle">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="properties-filters" id="propertiesPropertiesFilters">
                        <!-- Category Filter with Subcategories -->
                        <div class="filter-section category-section-centered" id="propertiesCategorySection">
                            <div class="category-main-buttons">
                                <button type="button" class="category-text-button" data-category="residential"
                                    id="propertiesFilterResidential">Residential</button>
                                <span class="category-divider">|</span>
                                <button type="button" class="category-text-button" data-category="commercial"
                                    id="propertiesFilterCommercial">Commercial</button>
                            </div>
                            <div class="category-subcategories-container">
                                <div class="subcategory-buttons" data-category="residential">
                                    <button type="button" class="filter-button subcategory-button"
                                        data-property-type="plots" data-parent-category="residential"
                                        id="propertiesFilterPlots">Plots</button>
                                    <button type="button" class="filter-button subcategory-button"
                                        data-property-type="apartment" data-parent-category="residential"
                                        id="propertiesFilterApartments">Apartments</button>
                                    <button type="button" class="filter-button subcategory-button"
                                        data-property-type="villa" data-parent-category="residential"
                                        id="propertiesFilterVillas">Villas</button>
                                </div>
                                <div class="subcategory-buttons" data-category="commercial">
                                    <button type="button" class="filter-button subcategory-button"
                                        data-property-type="office-space" data-parent-category="commercial"
                                        id="propertiesFilterOfficeSpace">Office Space</button>
                                    <button type="button" class="filter-button subcategory-button"
                                        data-property-type="warehouse" data-parent-category="commercial"
                                        id="propertiesFilterWarehouse">Warehouse</button>
                                    <button type="button" class="filter-button subcategory-button"
                                        data-property-type="showrooms" data-parent-category="commercial"
                                        id="propertiesFilterShowrooms">Showrooms</button>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Search Form -->
                        <div class="properties-search">
                            <form class="search-form" id="propertiesPropertiesSearchForm">
                                <!-- filter-group-sidebar: aligned to Step 2 of add property modal (all property types) -->
                                <div class="filter-group-sidebar">
                                    <!-- Common (all types) -->
                                    <div class="search-group filter-group" data-filter-for="common">
                                        <label><i class="fas fa-map-marker-alt"></i> City</label>
                                        <select id="propertiesSearchCity">
                                            <option value="">Any City</option>
                                        </select>
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="common">
                                        <label><i class="fas fa-map-marker-alt"></i> Area</label>
                                        <select id="propertiesSearchArea">
                                            <option value="">Any Area</option>
                                        </select>
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="common">
                                        <label><i class="fas fa-exchange-alt"></i> Transaction Type</label>
                                        <select id="propertiesSearchTransactionType">
                                            <option value="all">All Properties</option>
                                            <option value="sale">Buy</option>
                                            <option value="rent">Rent</option>
                                        </select>
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="common">
                                        <label><i class="fas fa-check-circle"></i> Status</label>
                                        <select id="propertiesSearchPropertyCondition">
                                            <option value="">Any Status</option>
                                            <option value="new">New</option>
                                            <option value="resale">Resale</option>
                                        </select>
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="common">
                                        <label>
                                            <span class="currency-symbol">₹</span> Price Range
                                        </label>
                                        <button type="button" class="price-range-btn" id="propertiesPriceRangeBtn">
                                            <span class="price-range-display" id="propertiesPriceRangeDisplay">Any
                                                Price</span>
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <input type="hidden" id="propertiesSearchPrice" value="">
                                    </div>
                                    <!-- Direction: Step 2 only in Apartments -->
                                    <div class="search-group filter-group" data-filter-for="apartment">
                                        <label><i class="fas fa-compass"></i> Direction</label>
                                        <select id="propertiesSearchDirection">
                                            <option value="">Any Direction</option>
                                            <option value="east">East</option>
                                            <option value="west">West</option>
                                            <option value="north">North</option>
                                            <option value="south">South</option>
                                            <option value="northeast">North East</option>
                                            <option value="northwest">North West</option>
                                            <option value="southeast">South East</option>
                                            <option value="southwest">South West</option>
                                        </select>
                                    </div>
                                    <!-- Unit Type: Step 2 in apartment, house, villa -->
                                    <div class="search-group filter-group" data-filter-for="apartment house villa">
                                        <label><i class="fas fa-home"></i> Unit Type</label>
                                        <select id="propertiesSearchUnitType">
                                            <option value="">Any Unit Type</option>
                                        </select>
                                    </div>
                                    <!-- Villa Type: Step 2 in villa -->
                                    <div class="search-group filter-group" data-filter-for="villa">
                                        <label><i class="fas fa-home"></i> Villa Type</label>
                                        <select id="propertiesSearchVillaType">
                                            <option value="">Any Villa Type</option>
                                            <option value="independent_villa">Independent Villa</option>
                                            <option value="row_villa">Row Villa</option>
                                            <option value="villament">Villament</option>
                                        </select>
                                    </div>
                                    <!-- Bedrooms: Step 2 in apartment, house, villa -->
                                    <div class="search-group filter-group" data-filter-for="apartment house villa">
                                        <label><i class="fas fa-bed"></i> Min Bedrooms</label>
                                        <input type="number" id="propertiesSearchBedrooms" placeholder="e.g., 2" min="0" max="10" step="1">
                                    </div>
                                    <!-- Bathrooms: Step 2 in apartment, house, villa -->
                                    <div class="search-group filter-group" data-filter-for="apartment house villa">
                                        <label><i class="fas fa-bath"></i> Min Bathrooms</label>
                                        <input type="number" id="propertiesSearchBathrooms" placeholder="e.g., 2" min="0" max="10" step="1">
                                    </div>
                                    <!-- Warehouse Type: Step 2 in warehouse -->
                                    <div class="search-group filter-group" data-filter-for="warehouse">
                                        <label><i class="fas fa-warehouse"></i> Warehouse Type</label>
                                        <select id="propertiesSearchWarehouseType">
                                            <option value="">Any Type</option>
                                            <option value="cold_storage">Cold storage</option>
                                            <option value="industrial">Industrial</option>
                                            <option value="logistic">Logistic</option>
                                        </select>
                                    </div>
                                    <!-- Amenities: Step 2 in apartment, house, villa, office-space, showrooms, warehouse -->
                                    <div class="search-group filter-group" data-filter-for="apartment house villa office-space showrooms warehouse">
                                        <label><i class="fas fa-star"></i> Amenities</label>
                                        <select id="propertiesSearchAmenities">
                                            <option value="">Any Amenity</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- filter-additional-sidebar: Step 2 dimension/area fields per property type -->
                                <div class="filter-additional-sidebar">
                                    <!-- Plot Area: Step 2 in plots, villa, warehouse -->
                                    <div class="search-group filter-group" data-filter-for="plots villa warehouse">
                                        <label><i class="fas fa-map"></i> Plot Area (sq.ft)</label>
                                        <input type="number" id="propertiesSearchPlotArea" placeholder="Min plot area (sq ft)" step="0.01" min="0">
                                    </div>
                                    <!-- Length/Breadth: Step 2 in plots, villa, house -->
                                    <div class="search-group filter-group" data-filter-for="plots villa house">
                                        <label><i class="fas fa-ruler"></i> Length (ft)</label>
                                        <input type="number" id="propertiesSearchLength" placeholder="e.g., 30" step="0.01" min="0">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="plots villa house">
                                        <label><i class="fas fa-ruler"></i> Breadth (ft)</label>
                                        <input type="number" id="propertiesSearchBreadth" placeholder="e.g., 40" step="0.01" min="0">
                                    </div>
                                    <!-- Buildup Area: Step 2 in villa, house -->
                                    <div class="search-group filter-group" data-filter-for="villa house">
                                        <label><i class="fas fa-ruler-combined"></i> Buildup Area (sq.ft)</label>
                                        <input type="number" id="propertiesSearchBuildupArea" placeholder="Min buildup (sq ft)" step="0.01" min="0">
                                    </div>
                                    <!-- Super Builtup Area: Step 2 in apartment, office-space, showrooms, warehouse -->
                                    <div class="search-group filter-group" data-filter-for="apartment office-space showrooms warehouse">
                                        <label><i class="fas fa-ruler-combined"></i> Super Builtup Area (sq.ft)</label>
                                        <input type="number" id="propertiesSearchSuperBuildupArea" placeholder="Min super builtup (sq ft)" step="0.01" min="0">
                                    </div>
                                    <!-- Carpet Area: Step 2 in apartment, house, villa, office-space, showrooms, warehouse -->
                                    <div class="search-group filter-group" data-filter-for="apartment house villa office-space showrooms warehouse">
                                        <label><i class="fas fa-vector-square"></i> Carpet Area (sq.ft)</label>
                                        <input type="number" id="propertiesSearchCarpetArea" placeholder="Min carpet area (sq ft)" step="0.01" min="0">
                                    </div>
                                    <!-- Office Space: Step 2 -->
                                    <div class="search-group filter-group" data-filter-for="office-space">
                                        <label><i class="fas fa-layer-group"></i> Min Total Floors</label>
                                        <input type="number" id="propertiesSearchTotalFloors" placeholder="e.g., 5" min="1" step="1">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="office-space">
                                        <label><i class="fas fa-chair"></i> Min Seats / Workstations</label>
                                        <input type="number" id="propertiesSearchTotalSeats" placeholder="e.g., 50" min="0" step="1">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="office-space">
                                        <label><i class="fas fa-door-open"></i> Min Cabins</label>
                                        <input type="number" id="propertiesSearchNumberCabins" placeholder="e.g., 2" min="0" step="1">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="office-space">
                                        <label><i class="fas fa-parking"></i> Min Parking Slots</label>
                                        <input type="number" id="propertiesSearchParkingSlots" placeholder="e.g., 5" min="0" step="1">
                                    </div>
                                    <!-- Showrooms: Step 2 -->
                                    <div class="search-group filter-group" data-filter-for="showrooms">
                                        <label><i class="fas fa-layer-group"></i> Min Total Floors (Showroom)</label>
                                        <input type="number" id="propertiesSearchShowroomTotalFloors" placeholder="e.g., 3" min="1" step="1">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="showrooms">
                                        <label><i class="fas fa-arrows-alt-h"></i> Min Frontage Width (ft)</label>
                                        <input type="number" id="propertiesSearchFrontageWidth" placeholder="e.g., 30" step="0.01" min="0">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="showrooms">
                                        <label><i class="fas fa-walking"></i> Footfall Potential</label>
                                        <select id="propertiesSearchFootfallPotential">
                                            <option value="">Any</option>
                                            <option value="low">Low</option>
                                            <option value="medium">Medium</option>
                                            <option value="high">High</option>
                                        </select>
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="showrooms">
                                        <label><i class="fas fa-th-large"></i> Min Ground Floor Area (sq.ft)</label>
                                        <input type="number" id="propertiesSearchGroundFloorArea" placeholder="e.g., 2000" step="0.01" min="0">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="showrooms">
                                        <label><i class="fas fa-arrows-alt-v"></i> Min Ceiling Height (ft)</label>
                                        <input type="number" id="propertiesSearchCeilingHeight" placeholder="e.g., 12" step="0.01" min="0">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="showrooms">
                                        <label><i class="fas fa-layer-group"></i> Min Mezzanine Area (sq.ft)</label>
                                        <input type="number" id="propertiesSearchMezzanineArea" placeholder="e.g., 500" step="0.01" min="0">
                                    </div>
                                    <!-- Warehouse: Step 2 -->
                                    <div class="search-group filter-group" data-filter-for="warehouse">
                                        <label><i class="fas fa-arrows-alt-v"></i> Min Clearance Height (ft)</label>
                                        <input type="number" id="propertiesSearchClearanceHeight" placeholder="e.g., 25" step="0.01" min="0">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="warehouse">
                                        <label><i class="fas fa-truck-loading"></i> Min Dock Levelers</label>
                                        <input type="number" id="propertiesSearchDockLevelers" placeholder="e.g., 2" min="0" step="1">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="warehouse">
                                        <label><i class="fas fa-door-closed"></i> Min Shutters</label>
                                        <input type="number" id="propertiesSearchNumberShutters" placeholder="e.g., 4" min="0" step="1">
                                    </div>
                                    <div class="search-group filter-group" data-filter-for="warehouse">
                                        <label><i class="fas fa-weight-hanging"></i> Min Floor Load (Kg/sq.ft)</label>
                                        <input type="number" id="propertiesSearchFloorLoadCapacity" placeholder="e.g., 500" step="0.01" min="0">
                                    </div>
                                </div>

                                <div class="filter-button-center">
                                    <button type="submit" class="btn-search">
                                        <i class="fas fa-filter"></i>
                                        <span>Apply Filters</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Active Filter Tags -->
                        <div class="filter-tags-container" id="propertiesFilterTagsContainer" style="display: none;">
                            <div class="filter-tags-header">
                                <span class="filter-tags-label">Active:</span>
                                <button type="button" class="clear-all-filters" id="propertiesClearAllFilters">
                                    <i class="fas fa-times-circle"></i>
                                </button>
                            </div>
                            <div class="filter-tags" id="propertiesFilterTags">
                                <!-- Filter tags will be rendered here by JavaScript -->
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Main Content Area -->
                <div class="properties-main-content">
                    <!-- Mobile Filter Toggle Button -->
                    <button class="mobile-filter-toggle" id="mobileFilterToggle">
                        <i class="fas fa-filter"></i>
                        <span>Show Filters</span>
                    </button>

                    <!-- Loading State -->
                    <div class="properties-loading" id="propertiesLoading" style="display: none;">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <p>Loading properties...</p>
                    </div>

                    <!-- Error State -->
                    <div class="properties-error" id="propertiesError" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Best Properties Being Selected</h3>
                        <p>Best of the properties are being selected for you, please wait...</p>
                        <button class="btn-retry" id="retryLoadBtn">Retry</button>
                    </div>

                    <!-- Properties Grid -->
                    <div class="properties-grid" id="propertiesGrid">
                        <!-- Properties will be rendered here by JavaScript -->
                    </div>

                    <!-- Load More Button -->
                    <div class="properties-load-more">
                        <button class="btn-load-more" id="loadMoreBtn">
                            <span>Load More Properties</span>
                            <i class="fas fa-arrow-down"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Price Range Modal -->
    <div class="price-range-modal" id="propertiesPriceRangeModal">
        <div class="price-range-modal-overlay" id="propertiesPriceRangeModalOverlay"></div>
        <div class="price-range-modal-content">
            <div class="price-range-modal-header">
                <h3>Select Price Range</h3>
                <button type="button" class="price-range-modal-close" id="propertiesPriceRangeModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="price-range-modal-body">
                <div class="price-range-slider-container">
                    <div class="price-range-labels">
                        <span class="price-range-label-min" id="propertiesPriceRangeLabelMin">₹0</span>
                        <span class="price-range-label-max" id="propertiesPriceRangeLabelMax">₹100+ Cr</span>
                    </div>
                    <div class="price-range-slider-wrapper">
                        <div class="price-range-track" id="propertiesPriceRangeTrack">
                            <div class="price-range-progress" id="propertiesPriceRangeProgress"></div>
                            <input type="range" class="price-range-input price-range-input-min"
                                id="propertiesPriceRangeMin" min="0" max="100" value="0" step="0.1">
                            <input type="range" class="price-range-input price-range-input-max"
                                id="propertiesPriceRangeMax" min="0" max="100" value="100" step="0.1">
                        </div>
                    </div>
                    <div class="price-range-inputs">
                        <div class="price-range-input-group">
                            <label>Min Price (Cr)</label>
                            <input type="number" class="price-range-number-input" id="propertiesPriceRangeMinInput"
                                min="0" max="100" step="0.1" value="0">
                        </div>
                        <div class="price-range-input-group">
                            <label>Max Price (Cr)</label>
                            <input type="number" class="price-range-number-input" id="propertiesPriceRangeMaxInput"
                                min="0" max="100" step="0.1" value="100">
                        </div>
                    </div>
                </div>
            </div>
            <div class="price-range-modal-footer">
                <button type="button" class="price-range-btn-clear" id="propertiesPriceRangeBtnClear">Clear</button>
                <button type="button" class="price-range-btn-apply" id="propertiesPriceRangeBtnApply">Apply</button>
            </div>
        </div>
    </div>

    <!-- Contact Information Modal -->
    <div class="login-modal" id="contactInfoModal">
        <div class="login-modal-overlay" id="contactInfoModalOverlay"></div>
        <div class="login-modal-content contact-modal-content">
            <button class="login-modal-close" id="contactInfoModalClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="container">
                <div class="section-header">
                    <h2>Get In Touch</h2>
                    <p>Have questions? We'd love to hear from you</p>
                </div>
                <div class="contact-content">
                    <div class="contact-info">
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div>
                                <h4>Address</h4>
                                <p>78, SBM COLONY, 2ND CROSS, KONANAKUNTE<br>BANGALORE - 560062</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div>
                                <h4>Phone</h4>
                                <p>+91 97411 11756</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div>
                                <h4>Email</h4>
                                <p>info@tirumakudaluproperties.com</p>
                            </div>
                        </div>
                    </div>
                    <form class="contact-form" id="contactForm">
                        <div class="form-row">
                            <div class="form-group">
                                <input type="text" id="contactName" name="name" placeholder="Your Name" required>
                            </div>
                            <div class="form-group">
                                <input type="email" id="contactEmail" name="email" placeholder="Your Email" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="text" id="contactSubject" name="subject" placeholder="Subject" required>
                        </div>
                        <div class="form-group">
                            <textarea id="contactMessage" name="message" placeholder="Your Message" rows="5"
                                required></textarea>
                        </div>
                        <div class="form-group">
                            <input type="tel" id="contactPhone" name="phone" placeholder="Phone Number (Optional)">
                        </div>
                        <div class="form-message" id="contactFormMessage" style="display: none;"></div>
                        <button type="submit" class="btn btn-primary" id="contactSubmitBtn">
                            <span class="btn-text">Send Message</span>
                            <span class="btn-loader" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> Sending...
                            </span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Visitor Info Popup Modal -->
    <div class="visitor-modal" id="visitorModal">
        <div class="visitor-modal-overlay" id="visitorModalOverlay"></div>
        <div class="visitor-modal-content">
            <button class="visitor-modal-close" id="visitorModalClose" type="button">
                <i class="fas fa-times"></i>
            </button>
            <div class="visitor-modal-header">
                <div class="visitor-modal-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h2>Welcome to Tirumakudalu Properties</h2>
                <p>Please share your information so we can assist you better</p>
            </div>
            <form class="visitor-form" id="visitorForm">
                <div class="form-group">
                    <label for="visitorFullName">
                        <i class="fas fa-user"></i>
                        Full Name <span class="required">*</span>
                    </label>
                    <input type="text" id="visitorFullName" name="full_name" placeholder="Enter your full name"
                        required>
                </div>
                <div class="form-group">
                    <label for="visitorEmail">
                        <i class="fas fa-envelope"></i>
                        Email Address <span class="required">*</span>
                    </label>
                    <input type="email" id="visitorEmail" name="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="visitorPhone">
                        <i class="fas fa-phone"></i>
                        Phone Number <span class="required">*</span>
                    </label>
                    <input type="tel" id="visitorPhone" name="phone" placeholder="Enter your phone number" required>
                </div>
                <div class="form-group">
                    <label for="visitorLookingFor">
                        <i class="fas fa-search"></i>
                        What are you looking for?
                    </label>
                    <textarea id="visitorLookingFor" name="looking_for"
                        placeholder="E.g., 2BHK apartment for rent, investment property, etc." rows="3"></textarea>
                </div>
                <div class="visitor-form-message" id="visitorFormMessage" style="display: none;"></div>
                <div class="visitor-form-footer">
                    <button type="submit" class="btn-visitor-submit">
                        <span class="btn-text">Submit</span>
                        <span class="btn-loader" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> Submitting...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-modal-overlay" id="loginModalOverlay"></div>
        <div class="login-modal-content">
            <button class="login-modal-close" id="loginModalClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="login-modal-header">
                <div class="login-modal-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h2>Welcome Back</h2>
                <p>Sign in to your account to continue</p>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">
                        <i class="fas fa-envelope"></i>
                        Email Address
                    </label>
                    <input type="email" id="loginEmail" name="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">
                        <i class="fas fa-lock"></i>
                        Password
                    </label>
                    <div class="password-input-wrapper">
                        <input type="password" id="loginPassword" name="password" placeholder="Enter your password"
                            required>
                        <button type="button" class="password-toggle" id="passwordToggle">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="login-form-options">
                    <label class="remember-me">
                        <input type="checkbox" id="rememberMe" name="rememberMe">
                        <span>Remember Me</span>
                    </label>
                </div>
                <button type="submit" class="btn-login-submit">
                    <span>Sign In</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <div class="footer-logo">
                        <a href="/index.html" class="logo-link">
                            <div class="logo-graphic">
                                <img src="/images/TS_Logo_White .png" alt="Tirumakudalu Properties Logo" width="300px"
                                    height="auto" style="margin-left: 150px;" loading="lazy">
                            </div>
                        </a>
                    </div>
                    <p>Tirumakudalu Properties offers Property Management & Real Estate Services in and around Bangalore
                        City.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="/blogs.html">Blogs</a></li>
                        <li><a href="#">Terms and Conditions</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">NRI Property Investment</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contact Information</h4>
                    <ul class="footer-contact">
                        <li>
                            <i class="fas fa-phone"></i>
                            <span>+91 97411 11756</span>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <span>info@tirumakudaluproperties.com</span>
                        </li>
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>#76, 2ND floor, 2ND CROSS, Mysore Bank Colony, JP nagar, 7th Phase, BANGALORE -
                                560078</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Copyright &copy; 2025 - Designed & Powered by <span class="footer-credit">Purple Hue Technosoft Pvt.
                        Ltd.</span></p>
            </div>
        </div>
    </footer>

    <script>
        // Sidebar Toggle Functionality for Mobile
        (function () {
            'use strict';

            const mobileFilterToggle = document.getElementById('mobileFilterToggle');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.querySelector('.properties-sidebar');

            // Open sidebar
            if (mobileFilterToggle) {
                mobileFilterToggle.addEventListener('click', function () {
                    if (sidebar) {
                        sidebar.classList.add('active');
                        document.body.style.overflow = 'hidden';
                    }
                });
            }

            // Close sidebar
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function () {
                    if (sidebar) {
                        sidebar.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            }

            // Close sidebar when clicking overlay (on mobile)
            if (sidebar) {
                sidebar.addEventListener('click', function (e) {
                    if (e.target === sidebar && sidebar.classList.contains('active')) {
                        sidebar.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            }

            // Close sidebar on escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && sidebar && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        })();
    </script>

    <script>
        // Properties Page Filters - Inline JavaScript Bridge (MUST RUN BEFORE properties.js)
        // Maps old ID references to new "properties" prefixed IDs for compatibility with properties.js
        (function () {
            'use strict';

            // ID mapping: old ID -> new ID
            const idMap = {
                'searchCity': 'propertiesSearchCity',
                'searchArea': 'propertiesSearchArea',
                'searchAmenities': 'propertiesSearchAmenities',
                'searchDirection': 'propertiesSearchDirection',
                'searchDirections': 'propertiesSearchDirection',
                'searchPrice': 'propertiesSearchPrice',
                'searchTransactionType': 'propertiesSearchTransactionType',
                'searchPropertyCondition': 'propertiesSearchPropertyCondition',
                'searchUnitType': 'propertiesSearchUnitType',
                'searchLength': 'propertiesSearchLength',
                'searchBreadth': 'propertiesSearchBreadth',
                'searchCarpetArea': 'propertiesSearchCarpetArea',
                'searchVillaType': 'propertiesSearchVillaType',
                'searchWarehouseType': 'propertiesSearchWarehouseType',
                'searchPlotArea': 'propertiesSearchPlotArea',
                'searchSuperBuildupArea': 'propertiesSearchSuperBuildupArea',
                'searchBedrooms': 'propertiesSearchBedrooms',
                'searchBathrooms': 'propertiesSearchBathrooms',
                'searchBuildupArea': 'propertiesSearchBuildupArea',
                'searchTotalFloors': 'propertiesSearchTotalFloors',
                'searchTotalSeats': 'propertiesSearchTotalSeats',
                'searchNumberCabins': 'propertiesSearchNumberCabins',
                'searchParkingSlots': 'propertiesSearchParkingSlots',
                'searchShowroomTotalFloors': 'propertiesSearchShowroomTotalFloors',
                'searchFrontageWidth': 'propertiesSearchFrontageWidth',
                'searchFootfallPotential': 'propertiesSearchFootfallPotential',
                'searchGroundFloorArea': 'propertiesSearchGroundFloorArea',
                'searchCeilingHeight': 'propertiesSearchCeilingHeight',
                'searchMezzanineArea': 'propertiesSearchMezzanineArea',
                'searchClearanceHeight': 'propertiesSearchClearanceHeight',
                'searchDockLevelers': 'propertiesSearchDockLevelers',
                'searchNumberShutters': 'propertiesSearchNumberShutters',
                'searchFloorLoadCapacity': 'propertiesSearchFloorLoadCapacity',
                'propertiesSearchForm': 'propertiesPropertiesSearchForm',
                'filterTagsContainer': 'propertiesFilterTagsContainer',
                'filterTags': 'propertiesFilterTags',
                'clearAllFilters': 'propertiesClearAllFilters',
                'priceRangeBtn': 'propertiesPriceRangeBtn',
                'priceRangeDisplay': 'propertiesPriceRangeDisplay',
                'priceRangeModal': 'propertiesPriceRangeModal',
                'priceRangeModalOverlay': 'propertiesPriceRangeModalOverlay',
                'priceRangeModalClose': 'propertiesPriceRangeModalClose',
                'priceRangeMin': 'propertiesPriceRangeMin',
                'priceRangeMax': 'propertiesPriceRangeMax',
                'priceRangeMinInput': 'propertiesPriceRangeMinInput',
                'priceRangeMaxInput': 'propertiesPriceRangeMaxInput',
                'priceRangeProgress': 'propertiesPriceRangeProgress',
                'priceRangeLabelMin': 'propertiesPriceRangeLabelMin',
                'priceRangeLabelMax': 'propertiesPriceRangeLabelMax',
                'priceRangeBtnClear': 'propertiesPriceRangeBtnClear',
                'priceRangeBtnApply': 'propertiesPriceRangeBtnApply'
            };

            // Patch getElementById to check for new IDs first
            const originalGetElementById = document.getElementById.bind(document);
            document.getElementById = function (id) {
                // Check mapped ID first
                if (idMap[id]) {
                    const mappedElement = originalGetElementById(idMap[id]);
                    if (mappedElement) return mappedElement;
                }
                // Fallback to original ID
                return originalGetElementById(id);
            };

            // Patch querySelector to use new IDs
            const originalQuerySelector = Element.prototype.querySelector;
            Element.prototype.querySelector = function (selector) {
                if (selector === '.category-section-centered') {
                    const element = originalQuerySelector.call(this, '#propertiesCategorySection');
                    if (element) return element;
                }
                return originalQuerySelector.call(this, selector);
            };

            // Patch querySelectorAll for category buttons (scope to properties filters)
            const originalQuerySelectorAll = Element.prototype.querySelectorAll;
            Element.prototype.querySelectorAll = function (selector) {
                // For category and subcategory buttons, scope to properties filters container
                if (selector.includes('.category-text-button') || selector.includes('.subcategory-button')) {
                    const container = document.getElementById('propertiesPropertiesFilters');
                    if (container) {
                        return container.querySelectorAll(selector);
                    }
                }
                return originalQuerySelectorAll.call(this, selector);
            };
        })();
    </script>
    <script src="/js/script.js" defer></script>
    <script src="/js/properties.js" defer></script>
    <script src="/js/page-tracking.js" async></script>
    <script src="/js/session-manager.js" defer></script>
    <script src="/js/app-metrics-tracker.js" async></script>
    <script src="/js/login.js" defer></script>
    <script>
        // Call Us Button Functionality
        (function () {
            const callUsBtn = document.querySelector('.btn-call-us');
            const contactInfoModal = document.getElementById('contactInfoModal');
            const contactInfoModalClose = document.getElementById('contactInfoModalClose');
            const contactInfoModalOverlay = document.getElementById('contactInfoModalOverlay');

            // Detect if device is mobile
            function isMobileDevice() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                    (window.matchMedia && window.matchMedia('(max-width: 768px)').matches);
            }

            // Open modal
            function openContactModal() {
                if (contactInfoModal) {
                    contactInfoModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            // Close modal
            function closeContactModal() {
                if (contactInfoModal) {
                    contactInfoModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }

            // Handle Call Us button click
            if (callUsBtn) {
                callUsBtn.addEventListener('click', (e) => {
                    // If mobile device, let the tel: link work normally
                    if (isMobileDevice()) {
                        // Allow default behavior (tel: link will open dialer)
                        return;
                    } else {
                        // If desktop, prevent default and show modal
                        e.preventDefault();
                        openContactModal();
                    }
                });
            }

            // Close modal handlers
            if (contactInfoModalClose) {
                contactInfoModalClose.addEventListener('click', closeContactModal);
            }

            if (contactInfoModalOverlay) {
                contactInfoModalOverlay.addEventListener('click', closeContactModal);
            }

            // Close on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && contactInfoModal && contactInfoModal.classList.contains('active')) {
                    closeContactModal();
                }
            });

            // Handle navigation contact link - intercept #contact hash links
            const contactNavLink = document.querySelector('a[href="#contact"]');
            if (contactNavLink) {
                contactNavLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    openContactModal();
                });
            }
        })();

    </script>
    <script>
        // Visitor Modal Functionality - Triggered by filter button, then every 20 seconds if skipped
        (function () {
            const visitorModal = document.getElementById('visitorModal');
            const visitorForm = document.getElementById('visitorForm');
            const visitorFormMessage = document.getElementById('visitorFormMessage');
            const visitorModalOverlay = document.getElementById('visitorModalOverlay');
            let visitorModalInterval = null;
            /** When user clicked "View Details", store that URL; after form submit we redirect here */
            let pendingPropertyDetailsUrl = null;

            // Storage keys
            const VISITOR_FORM_SUBMITTED_KEY = 'visitorFormSubmitted';
            const VISITOR_FORM_SKIPPED_KEY = 'visitorFormSkipped';
            const VISITOR_MODAL_TRIGGERED_KEY = 'visitorModalTriggeredByFilter';

            // Track server-side check status
            let serverCheckCompleted = false;
            let serverCheckResult = false;

            // Check with backend if visitor has already submitted (using session/IP tracking)
            async function checkVisitorSubmissionStatus() {
                try {
                    const response = await fetch('/api/visitor-info/check', {
                        method: 'GET',
                        credentials: 'include' // Important: include cookies for session
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        serverCheckResult = data.submitted === true;
                        serverCheckCompleted = true;
                        
                        // If server says already submitted, mark local storage too
                        if (serverCheckResult) {
                            sessionStorage.setItem(VISITOR_FORM_SUBMITTED_KEY, 'true');
                        }
                        
                        return serverCheckResult;
                    } else {
                        // On error, allow modal to show (fail open)
                        serverCheckCompleted = true;
                        return false;
                    }
                } catch (error) {
                    console.error('Error checking visitor submission status:', error);
                    // On error, allow modal to show (fail open)
                    serverCheckCompleted = true;
                    return false;
                }
            }

            // Show modal (only if not already submitted)
            async function showVisitorModal() {
                // Wait for server check if not completed yet
                if (!serverCheckCompleted) {
                    const submitted = await checkVisitorSubmissionStatus();
                    if (submitted) {
                        return; // Don't show modal if already submitted
                    }
                } else if (serverCheckResult) {
                    return; // Already checked and submitted
                }
                
                // Also check local sessionStorage as fallback
                if (isFormSubmitted()) {
                    return;
                }
                
                if (visitorModal) {
                    visitorModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            // Close modal
            function closeVisitorModal() {
                if (visitorModal) {
                    visitorModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }

            // Check if form was already submitted (local check)
            function isFormSubmitted() {
                return sessionStorage.getItem(VISITOR_FORM_SUBMITTED_KEY) === 'true';
            }
            
            // Check if form was already submitted (server check)
            async function isFormSubmittedServer() {
                if (!serverCheckCompleted) {
                    return await checkVisitorSubmissionStatus();
                }
                return serverCheckResult;
            }

            // Check if form was skipped
            function isFormSkipped() {
                return sessionStorage.getItem(VISITOR_FORM_SKIPPED_KEY) === 'true';
            }

            // Mark form as submitted
            function markFormSubmitted() {
                sessionStorage.setItem(VISITOR_FORM_SUBMITTED_KEY, 'true');
                sessionStorage.removeItem(VISITOR_FORM_SKIPPED_KEY);
                // Stop the interval if running
                if (visitorModalInterval) {
                    clearInterval(visitorModalInterval);
                    visitorModalInterval = null;
                }
            }

            // Mark form as skipped
            function markFormSkipped() {
                sessionStorage.setItem(VISITOR_FORM_SKIPPED_KEY, 'true');
                // Start the 20-second interval if not already running
                if (!visitorModalInterval && !isFormSubmitted()) {
                    startVisitorModalInterval();
                }
            }

            // Prevent closing modal with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && visitorModal && visitorModal.classList.contains('active')) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            });

            // Close modal when clicking overlay
            if (visitorModalOverlay) {
                visitorModalOverlay.addEventListener('click', () => {
                    closeVisitorModal();
                    // Mark as skipped if form wasn't submitted
                    if (!isFormSubmitted()) {
                        markFormSkipped();
                    }
                });
            }

            // Close button functionality
            const visitorModalClose = document.getElementById('visitorModalClose');
            if (visitorModalClose) {
                visitorModalClose.addEventListener('click', () => {
                    closeVisitorModal();
                    // Mark as skipped if form wasn't submitted
                    if (!isFormSubmitted()) {
                        markFormSkipped();
                    }
                });
            }

            // Form submission - prevent duplicate submissions
            let isSubmitting = false;
            if (visitorForm) {
                // Remove any existing event listener first to prevent duplicates
                const submitHandler = async (e) => {
                    e.preventDefault();
                    e.stopImmediatePropagation();

                    // Prevent duplicate submissions
                    if (isSubmitting) {
                        console.log('Form submission already in progress, ignoring duplicate request');
                        return;
                    }

                    // Check if form was already submitted (local and server)
                    if (isFormSubmitted()) {
                        showVisitorMessage('Form has already been submitted.', 'error');
                        return;
                    }
                    
                    // Also check server-side session
                    const serverSubmitted = await isFormSubmittedServer();
                    if (serverSubmitted) {
                        showVisitorMessage('Form has already been submitted.', 'error');
                        markFormSubmitted(); // Sync local storage
                        return;
                    }

                    isSubmitting = true;

                    const submitBtn = visitorForm.querySelector('.btn-visitor-submit');
                    const btnText = submitBtn.querySelector('.btn-text');
                    const btnLoader = submitBtn.querySelector('.btn-loader');

                    // Get form values
                    const formData = {
                        full_name: document.getElementById('visitorFullName').value.trim(),
                        email: document.getElementById('visitorEmail').value.trim(),
                        phone: document.getElementById('visitorPhone').value.trim(),
                        looking_for: document.getElementById('visitorLookingFor').value.trim() || null
                    };

                    // Validate required fields
                    if (!formData.full_name || !formData.email || !formData.phone) {
                        showVisitorMessage('Please fill in all required fields.', 'error');
                        isSubmitting = false;
                        return;
                    }

                    // Validate email format
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(formData.email)) {
                        showVisitorMessage('Please enter a valid email address.', 'error');
                        isSubmitting = false;
                        return;
                    }

                    // Show loading state
                    submitBtn.disabled = true;
                    if (btnText) btnText.style.display = 'none';
                    if (btnLoader) btnLoader.style.display = 'inline';
                    if (visitorFormMessage) visitorFormMessage.style.display = 'none';

                    try {
                        const response = await fetch('/api/visitor-info', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            credentials: 'include', // Important: include cookies for session
                            body: JSON.stringify(formData)
                        });

                        const data = await response.json();
                        
                        // Check if server says form was already submitted (200 response with submitted flag)
                        if (response.ok && data.submitted === true) {
                            markFormSubmitted();
                            serverCheckResult = true;
                            serverCheckCompleted = true;
                            showVisitorMessage('Form has already been submitted.', 'error');
                            isSubmitting = false;
                            return;
                        }
                        
                        if (!response.ok) {
                            let errorMessage = 'Failed to submit. Please try again.';
                            if (data) {
                                errorMessage = data.detail || data.error || data.message || errorMessage;
                            }
                            showVisitorMessage(errorMessage, 'error');
                            isSubmitting = false;
                            return;
                        }

                        // Success - mark as submitted immediately to prevent duplicate submissions
                        markFormSubmitted();
                        // Update server check status
                        serverCheckResult = true;
                        serverCheckCompleted = true;
                        showVisitorMessage('Thank you! We will get in touch with you soon.', 'success');
                        // Reset isSubmitting after successful submission (sessionStorage check will prevent duplicates)
                        isSubmitting = false;
                        const urlToRedirect = pendingPropertyDetailsUrl;
                        pendingPropertyDetailsUrl = null;
                        // Close modal after 2 seconds, then redirect to property details if they came from View Details
                        setTimeout(() => {
                            closeVisitorModal();
                            visitorForm.reset();
                            if (urlToRedirect) {
                                window.location.href = urlToRedirect;
                            }
                        }, 2000);
                    } catch (error) {
                        console.error('Error submitting visitor form:', error);
                        showVisitorMessage('Network error. Please check your connection and try again.', 'error');
                        // Reset button state on error
                        submitBtn.disabled = false;
                        if (btnText) btnText.style.display = 'inline';
                        if (btnLoader) btnLoader.style.display = 'none';
                        isSubmitting = false;
                    }
                };

                // Remove any existing listener before adding new one
                visitorForm.removeEventListener('submit', submitHandler);
                visitorForm.addEventListener('submit', submitHandler);
            }

            // Helper function to show messages
            function showVisitorMessage(message, type) {
                if (!visitorFormMessage) return;

                visitorFormMessage.textContent = message;
                visitorFormMessage.className = `visitor-form-message ${type}`;
                visitorFormMessage.style.display = 'block';

                // Scroll to message
                visitorFormMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            // Show modal every 20 seconds (only if skipped)
            function startVisitorModalInterval() {
                // Don't start if form was already submitted
                if (isFormSubmitted() || serverCheckResult) {
                    return;
                }

                // Then show every 20 seconds
                visitorModalInterval = setInterval(async () => {
                    // Only show if modal is not already active and form wasn't submitted
                    if (visitorModal && !visitorModal.classList.contains('active') && !isFormSubmitted() && !serverCheckResult) {
                        await showVisitorModal();
                    }
                }, 20000); // 20 seconds = 20000 milliseconds
            }

            // Trigger modal on filter button click (first time only)
            function initFilterButtonTrigger() {
                const filterForm = document.getElementById('propertiesPropertiesSearchForm');
                if (filterForm) {
                    filterForm.addEventListener('submit', async (e) => {
                        // Check if modal was already triggered by filter button
                        const alreadyTriggered = sessionStorage.getItem(VISITOR_MODAL_TRIGGERED_KEY) === 'true';

                        // Check server-side session
                        const submitted = await isFormSubmittedServer();

                        // Only show modal if:
                        // 1. It hasn't been triggered by filter button before
                        // 2. Form wasn't already submitted (local or server)
                        if (!alreadyTriggered && !isFormSubmitted() && !submitted) {
                            // Mark as triggered
                            sessionStorage.setItem(VISITOR_MODAL_TRIGGERED_KEY, 'true');

                            // Show modal after a short delay (let filter process first)
                            setTimeout(async () => {
                                await showVisitorModal();
                            }, 500);
                        }
                    });
                }
            }

            // Trigger modal when user clicks "View Details" on a property card; after form submit, redirect to that property
            function initViewDetailsTrigger() {
                const propertiesGrid = document.getElementById('propertiesGrid');
                if (propertiesGrid) {
                    propertiesGrid.addEventListener('click', async (e) => {
                        const viewDetailsLink = e.target.closest('.btn-view-details');
                        if (viewDetailsLink) {
                            // Check server-side session before showing modal
                            const submitted = await isFormSubmittedServer();
                            if (!submitted && !isFormSubmitted()) {
                                e.preventDefault();
                                const href = viewDetailsLink.getAttribute('href');
                                if (href) {
                                    pendingPropertyDetailsUrl = href.startsWith('/') ? (window.location.origin + href) : href;
                                }
                                await showVisitorModal();
                            }
                        }
                    });
                }
            }

            // Show visitor modal on page load (when customer opens properties.html)
            async function showVisitorModalOnPageLoad() {
                // Check server-side session first
                const submitted = await checkVisitorSubmissionStatus();
                if (submitted) {
                    return; // Don't show modal if already submitted
                }
                
                if (isFormSubmitted()) return;
                // Small delay so page renders first
                setTimeout(async () => {
                    // Double-check server status before showing
                    if (!isFormSubmitted() && !serverCheckResult && visitorModal && !visitorModal.classList.contains('active')) {
                        await showVisitorModal();
                    }
                }, 800);
            }

            // Initialize on page load
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    initFilterButtonTrigger();
                    initViewDetailsTrigger();
                    showVisitorModalOnPageLoad();

                    // If form was skipped before, start the interval
                    if (isFormSkipped() && !isFormSubmitted()) {
                        startVisitorModalInterval();
                    }
                });
            } else {
                initFilterButtonTrigger();
                initViewDetailsTrigger();
                showVisitorModalOnPageLoad();

                // If form was skipped before, start the interval
                if (isFormSkipped() && !isFormSubmitted()) {
                    startVisitorModalInterval();
                }
            }

            // Clean up interval on page unload
            window.addEventListener('beforeunload', () => {
                if (visitorModalInterval) {
                    clearInterval(visitorModalInterval);
                }
            });
        })();
    </script>
    <script>
        // Suppress browser extension errors that are not related to our code
        window.addEventListener('error', function (event) {
            // Suppress common browser extension errors
            if (event.message && (
                event.message.includes('message channel closed') ||
                event.message.includes('Extension context invalidated') ||
                event.message.includes('Receiving end does not exist') ||
                event.message.includes('asynchronous response') ||
                event.message.includes('message channel closed before a response')
            )) {
                event.preventDefault();
                event.stopPropagation();
                return false;
            }
        }, true);

        // Suppress unhandled promise rejections from browser extensions
        window.addEventListener('unhandledrejection', function (event) {
            if (event.reason && typeof event.reason === 'object' && event.reason.message) {
                const message = event.reason.message;
                if (message.includes('message channel closed') ||
                    message.includes('Extension context invalidated') ||
                    message.includes('Receiving end does not exist') ||
                    message.includes('asynchronous response') ||
                    message.includes('message channel closed before a response')) {
                    event.preventDefault();
                    return false;
                }
            }
            // Also check string errors
            if (typeof event.reason === 'string' && (
                event.reason.includes('message channel closed') ||
                event.reason.includes('Extension context invalidated') ||
                event.reason.includes('asynchronous response') ||
                event.reason.includes('message channel closed before a response')
            )) {
                event.preventDefault();
                return false;
            }
        });
    </script>
    <script>
        // Make the page visible after it has loaded to prevent FOUC
        document.documentElement.classList.add('loaded');
    </script>
</body>

</html>